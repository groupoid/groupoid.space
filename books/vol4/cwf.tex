\documentclass{article}
\usepackage{amsmath, amssymb}
\usepackage{listings}
\usepackage{tikz}

\include{journal}

\begin{document}

\title{Issue XXX: Categories with Families}
\author{Namdak Tonpa}

% Generating title
\maketitle

% Abstract
\begin{abstract}
Martin-Löf Type Theory (MLTT-75), a foundational system for constructive mathematics and programming, can be elegantly formalized using the categorical framework of Categories with Families (CwF), as introduced by Peter Dybjer. This article presents MLTT-75 through the lens of CwFs, defining its syntax as an initial model within a category of models. We outline the core components of the CwF structure, including contexts, types, substitutions, and terms, and illustrate key type formers such as \(\Pi\)-types, \(\Sigma\)-types, and universes. Drawing on the algebraic signature from recent formalizations, we provide a concise yet rigorous exposition suitable for researchers and students of type theory and category theory.
\end{abstract}

\ifincludeTOC
  \tableofcontents
\fi

\newpage
\section{Categories with Families}
Martin-Löf Type Theory, particularly its 1975 formulation (MLTT-75), is a dependent type theory that serves as a foundation for proof assistants like Agda and Coq. Categories with Families, introduced by Dybjer \cite{Dybjer1995}, offer a categorical semantics for dependent type theories, modeling contexts as objects, types as presheaves, and terms as sections. This framework captures the algebraic structure of MLTT-75, where the syntax is the initial model in a category of models, and morphisms are structure-preserving maps.

This article formalizes MLTT-75 using CwFs, focusing on its algebraic signature and key type formers. We assume familiarity with basic category theory and type theory, referencing the comprehensive formalization in \cite{Kaposi2019} for technical details.

A Category with Families consists of a category of contexts and substitutions, equipped with presheaves of types and terms, satisfying specific structural properties. Formally, a CwF for MLTT-75 includes:

\begin{itemize}
    \item \textbf{Contexts} (\(\mathcal{C}\)): A category where objects (\(\Gamma, \Delta\)) represent contexts (sequences of typed variables), and morphisms (\(\sigma : \Gamma \to \Delta\)) represent substitutions.
    \item \textbf{Types} (\(\mathrm{Ty}\)): A presheaf \(\mathrm{Ty} : \mathcal{C}^{\mathrm{op}} \to \mathrm{Set}\), where \(\mathrm{Ty}(\Gamma)\) is the set of types in context \(\Gamma\), and for \(\sigma : \Gamma \to \Delta\), \(\mathrm{Ty}(\sigma) : \mathrm{Ty}(\Delta) \to \mathrm{Ty}(\Gamma)\) denotes type substitution.
    \item \textbf{Terms} (\(\mathrm{Tm}\)): For each type \(A \in \mathrm{Ty}(\Gamma)\), a set \(\mathrm{Tm}(\Gamma, A)\) of terms, with a substitution action \(\mathrm{Tm}(\Gamma, A) \to \mathrm{Tm}(\Gamma, A[\sigma])\) for \(\sigma : \Gamma \to \Delta\).
    \item \textbf{Structural Rules}: Identity substitutions (\(\mathrm{id} : \Gamma \to \Gamma\)), composition of substitutions (\(\sigma \circ \delta\)), and equations like associativity (\((\sigma \circ \delta) \circ \nu = \sigma \circ (\delta \circ \nu)\)).
\end{itemize}

The syntax of MLTT-75 is the initial CwF, generated by its algebraic signature, which includes type formers and their equations.

\subsection{Визначення}

\begin{definition}[Fam]
Категорія $Fam$ --- це категорія сімей множин, де об’єкти є залежними функціональними просторами $(x:A)\rightarrow B(x)$, а морфізми з доменом $\Pi(A,B)$ і кодоменом $\Pi(A',B')$ --- це пари функцій $\langle f:A\rightarrow A', g(x:A):B(x)\rightarrow B'(f(x)) \rangle$.
\end{definition}

\begin{definition}[$\Pi$-похідність]
Для контексту $\Gamma$ і типу $A$ позначимо $\Gamma\vdash A = (\gamma:\Gamma)\rightarrow A(\gamma)$.
\end{definition}

\begin{definition}[$\Sigma$-охоплення]
Для контексту $\Gamma$ і типу $A$ маємо $\Gamma;A = (\gamma:\Gamma)*A(\gamma)$. Охоплення не є асоціативним:
\[
    \Gamma;A;B \neq \Gamma;B;A
\]
\end{definition}

\begin{definition}[Контекст]
Категорія контекстів $C$ --- це категорія, де об’єкти є контекстами, а морфізми --- підстановками. Термінальний об’єкт $\Gamma=0$ у $C$ називається порожнім контекстом. Операція охоплення контексту $\Gamma;A = (x:\Gamma)*A(x)$ має елімінатори: $p:\Gamma;A\vdash\Gamma$, $q:\Gamma;A\vdash A(p)$, що задовольняють універсальну властивість: для будь-якого $\Delta:ob(C)$, морфізму $\gamma:\Delta\rightarrow\Gamma$ і терму $a:\Delta\rightarrow A$ існує єдиний морфізм $\theta=\langle\gamma,a\rangle:\Delta\rightarrow\Gamma;A$, такий що $p\circ\theta=\gamma$ і $q(\theta)=a$. Твердження: підстановка є асоціативною:
\[
    \gamma(\gamma(\Gamma,x,a),y,b) = \gamma(\gamma(\Gamma,y,b),x,a)
\]
\end{definition}

\begin{definition}[CwF-об’єкт]
CwF-об’єкт --- це пара $\Sigma(C, C\rightarrow Fam)$, де $C$ --- категорія контекстів з об’єктами-контекстами та морфізмами-підстановками, а $T:C\rightarrow Fam$ --- функтор, який відображає контекст $\Gamma$ у $C$ на сім’ю множин термів $\Gamma\vdash A$, а підстановку $\gamma:\Delta\rightarrow\Gamma$ --- на пару функцій, що виконують підстановку $\gamma$ у термах і типах відповідно.
\end{definition}

\begin{definition}[CwF-морфізм]
Нехай $(C,T):ob(C)$, де $T:C\rightarrow Fam$. CwF-морфізм $m: (C,T)\rightarrow(C',T')$ --- це пара $\langle F:C\rightarrow C', \sigma:T\rightarrow T'(F) \rangle$, де $F$ --- функтор, а $\sigma$ --- натуральна трансформація.
\end{definition}

\begin{definition}[Категорія типів]
Для CwF з об’єктами $(C,T)$ і морфізмами $(C,T)\rightarrow(C',T')$, для заданого контексту $\Gamma \in Ob(C)$ можна побудувати категорію $Type(\Gamma)$ --- категорію типів у контексті $\Gamma$, де об’єкти --- множина типів у контексті, а морфізми --- функції $f:\Gamma;A\rightarrow B(p)$.
\end{definition}

\begin{definition}[Терми та типи]
У CwF для контексту $\Gamma$ терми $\Gamma\vdash a:A$ є елементами множини $A(\gamma)$, де $\gamma:\Gamma$. Типи $\Gamma\vdash A$ є об’єктами в $Type(\Gamma)$, а підстановка $\gamma:\Delta\rightarrow\Gamma$ діє на типи та терми через функтор $T$.
\end{definition}

\begin{definition}[Залежні типи]
Залежний тип у контексті $\Gamma$ --- це відображення $\Gamma \rightarrow Fam$, де для кожного $\gamma:\Gamma$ задається множина $A(\gamma)$. У категорії $Type(\Gamma)$ залежні типи є об’єктами, а морфізми між $A$ і $B$ --- це функції $f: \Gamma;A \rightarrow B(p)$, що зберігають структуру підстановок.
\end{definition}

Martin-Löf Type Theory (MLTT-75) is a dependent type theory with $\Pi$-types, $\Sigma$-types, Id-types, and additional type formers like $\top$, universe types (U), and Bool. Its categorical semantics can be modeled using Categories with Families (CwF), a framework designed to capture contexts, types, terms, and context extension in a unified way \cite{awodey2019, ncatlab}. Unlike Grothendieck fibrations or comprehension categories, CwFs use a presheaf of families to represent types and terms, with context comprehension for type dependency. We formalize a CwF model for MLTT-75 in Agda, supporting all specified type formers, based on \cite{awodey2019}. Pullback diagrams, styled after Awodey’s natural models \cite{awodey}, illustrate the type formers, with constructors on upper arrows and type formers on lower arrows.

A Category with Families (CwF) models dependent type theory by assigning types and terms to contexts, with context comprehension for type dependency.

\newpage
\begin{definition}[Category with Families]
A \emph{Category with Families} (CwF) consists of:
\begin{itemize}
  \item A category $\mathcal{C}$ with a terminal object $1 \in \mathcal{C}.\text{Ob}$.
  \item A presheaf $\text{Ty} : \mathcal{C}^{\text{op}} \to \text{Set}$, assigning to each $\Gamma \in \mathcal{C}.\text{Ob}$ a set $\text{Ty}(\Gamma)$ of types, and to each $\sigma : \Delta \to \Gamma$ a function $\sigma^* : \text{Ty}(\Gamma) \to \text{Ty}(\Delta)$, preserving identities and composition.
  \item For each $\Gamma \in \mathcal{C}.\text{Ob}$ and $A \in \text{Ty}(\Gamma)$, a set $\text{Tm}(\Gamma, A)$ of terms, with reindexing: for $\sigma : \Delta \to \Gamma$, a function $\text{Tm}(\Gamma, A) \to \text{Tm}(\Delta, \sigma^* A)$, preserving identities and composition.
  \item For each $\Gamma \in \mathcal{C}.\text{Ob}$ and $A \in \text{Ty}(\Gamma)$, a context comprehension consisting of:
    \begin{itemize}
      \item An object $\Gamma.A \in \mathcal{C}.\text{Ob}$.
      \item A projection morphism $p_A : \Gamma.A \to \Gamma$.
      \item A universal term $q_A \in \text{Tm}(\Gamma.A, p_A^* A)$.
      \item For any $\Delta \in \mathcal{C}.\text{Ob}$, $\sigma : \Delta \to \Gamma$, and $t \in \text{Tm}(\Delta, \sigma^* A)$, there exists a unique $\langle \sigma, t \rangle : \Delta \to \Gamma.A$ such that $p_A \circ \langle \sigma, t \rangle = \sigma$ and $\langle \sigma, t \rangle^* q_A = t$.
    \end{itemize}
\end{itemize}
\end{definition}

\newpage
\subsection{Algebraic Signature of MLTT-75}
The CwF for MLTT-75 is defined by an algebraic signature, indexing contexts and types by universe levels to handle predicative universes. We present the core components and type formers, adapted from \cite{Kaposi2019}.

\begin{lstlisting}[mathescape=true]
def algebra : U₁ := Σ
    -- a semicategory of contexts and substitutions:
    (Con: U)
    (Sub: Con → Con → U)
    (◊: Π (Г Θ ∆ : Con), Sub Θ ∆ → Sub Г Θ → Sub Г ∆)
    (◊-assoc: Π (Г Θ ∆ Ф : Con) (σ: Sub Г Θ) (δ: Sub Θ ∆)
        (ν: Sub ∆ Ф), PathP (<_>Sub Г Ф) (◊ Г ∆ Ф ν (◊ Г Θ ∆ δ σ))
                                         (◊ Г Θ Ф (◊ Θ ∆ Ф ν δ) σ))
    -- identity morphisms as identity substitutions:
    (id: Π (Г : Con), Sub Г Г)
    (id-left: Π (Θ ∆ : Con) (δ : Sub Θ ∆),
              = (Sub Θ ∆) δ (◊ Θ ∆ ∆ (id ∆) δ))
    (id-right: Π (Θ ∆ : Con) (δ : Sub Θ ∆),
               = (Sub Θ ∆) δ (◊ Θ Θ ∆ δ (id Θ)))
    -- a terminal oject as empty context:
    (•: Con)
    (є: Π (Г : Con), Sub Г •)
    (•-η: Π (Г: Con) (δ: Sub Г •), = (Sub Г •) (є Г) δ)
    (Ty: Con → U)
    (_|_|ᵀ: Π (Г ∆ : Con), Ty ∆ → Sub Г ∆ → Ty Г)
    (|id|ᵀ: Π (∆: Con) (A: Ty ∆), = (Ty ∆) (_|_|ᵀ ∆ ∆ A (id ∆)) A)
    (|◊|ᵀ: Π (Г ∆ Ф: Con) (A : Ty Ф) (σ : Sub Г ∆) (δ : Sub ∆ Ф),
        =P (<_>Ty Г) (_|_|ᵀ Г Ф A (◊ Г ∆ Ф δ σ))
                        (_|_|ᵀ Г ∆ (_|_|ᵀ ∆ Ф A δ) σ))
    -- a (covariant) presheaf on the category of elements as terms:
    (Tm: Π (Г : Con), Ty Г → U)
    (_|_|ᵗ: Π (Г ∆ : Con) (A : Ty ∆) (B : Tm ∆ A)
              (σ: Sub Г ∆), Tm Г (_|_|ᵀ Г ∆ A σ))
    (|id|ᵗ: Π (∆ : Con) (A : Ty ∆) (t: Tm ∆ A),
            PathP (<i> Tm ∆ (|id|ᵀ ∆ A @ i))
                  (_|_|ᵗ ∆ ∆ A t (id ∆)) t)
    (|◊|ᵗ: Π (Г ∆ Ф: Con) (A : Ty Ф) (t: Tm Ф A)
             (σ : Sub Г ∆) (δ : Sub ∆ Ф),
             PathP (<i> Tm Г (|◊|ᵀ Г ∆ Ф A σ δ @ i))
                   (_|_|ᵗ Г Ф A t (◊ Г ∆ Ф δ σ))
          (_|_|ᵗ Г ∆ (_|_|ᵀ ∆ Ф A δ) (_|_|ᵗ ∆ Ф A t δ) σ))
\end{lstlisting}

\newpage
\subsection{Core Components}
The signature includes:
\begin{itemize}
    \item \(\mathrm{Con} : \mathbb{N} \to \mathrm{Set}\), contexts indexed by universe levels.
    \item \(\mathrm{Ty} : \mathbb{N} \to \mathrm{Con}\, i \to \mathrm{Set}\), types in a context at level \(i\).
    \item \(\mathrm{Sub} : \mathrm{Con}\, i \to \mathrm{Con}\, j \to \mathrm{Set}\), substitutions between contexts.
    \item \(\mathrm{Tm} : (\Gamma : \mathrm{Con}\, i) \to \mathrm{Ty}\, j\, \Gamma \to \mathrm{Set}\), terms of a type in a context.
\end{itemize}

Structural operations include:
\begin{itemize}
    \item Identity: \(\mathrm{id} : \mathrm{Sub}\, \Gamma\, \Gamma\).
    \item Composition: \(\_\circ\_ : \mathrm{Sub}\, \Theta\, \Delta \to \mathrm{Sub}\, \Gamma\, \Theta \to \mathrm{Sub}\, \Gamma\, \Delta\).
    \item Type substitution: \(\_[\_] : \mathrm{Ty}\, i\, \Delta \to \mathrm{Sub}\, \Gamma\, \Delta \to \mathrm{Ty}\, i\, \Gamma\).
    \item Term substitution: \(\_[\_] : \mathrm{Tm}\, \Delta\, A \to \mathrm{Sub}\, \Gamma\, \Delta \to \mathrm{Tm}\, \Gamma\, (A[\sigma])\).
\end{itemize}

Equations ensure categorical properties, e.g., \(\mathrm{id} \circ \sigma = \sigma\), \(\sigma \circ \mathrm{id} = \sigma\), and \(A[\mathrm{id}] = A\).

\subsection{Context Extension}
Contexts can be extended by types:
\begin{itemize}
    \item Empty context: \(\bullet : \mathrm{Con}\, 0\).
    \item Extension: \(\_\triangleright\_ : (\Gamma : \mathrm{Con}\, i) \to \mathrm{Ty}\, j\, \Gamma \to \mathrm{Con}\, (i \sqcup j)\).
    \item Weakening: \(p : \mathrm{Sub}\, (\Gamma \triangleright A)\, \Gamma\).
    \item Zeroth de Bruijn index: \(q : \mathrm{Tm}\, (\Gamma \triangleright A)\, (A[p])\).
\end{itemize}

Substitutions are extended by terms: \(\langle\sigma, t\rangle : \mathrm{Sub}\, \Gamma\, (\Delta \triangleright A)\), with equations like \(p \circ \langle\sigma, t\rangle = \sigma\).

\subsection{Type Formers}
MLTT-75 includes several type formers, formalized as follows:

% Subsubsection: Π-Types
\subsection{\(\Pi\)-Types}
Dependent function types are defined by:
\begin{itemize}
    \item Formation: \(\Pi : (A : \mathrm{Ty}\, i\, \Gamma) \to \mathrm{Ty}\, j\, (\Gamma \triangleright A) \to \mathrm{Ty}\, (i \sqcup j)\, \Gamma\).
    \item Introduction: \(\mathrm{lam} : \mathrm{Tm}\, (\Gamma \triangleright A)\, B \to \mathrm{Tm}\, \Gamma\, (\Pi A B)\).
    \item Elimination: \(\mathrm{app} : \mathrm{Tm}\, \Gamma\, (\Pi A B) \to \mathrm{Tm}\, (\Gamma \triangleright A)\, B\).
\end{itemize}

Equations include \(\beta\)-reduction (\(\mathrm{app}\, (\mathrm{lam}\, t) = t\)) and \(\eta\)-expansion (\(\mathrm{lam}\, (\mathrm{app}\, t) = t\)).

% Subsubsection: Σ-Types
\subsection{\(\Sigma\)-Types}
Dependent pair types:
\begin{itemize}
    \item Formation: \(\Sigma : (A : \mathrm{Ty}\, i\, \Gamma) \to \mathrm{Ty}\, j\, (\Gamma \triangleright A) \to \mathrm{Ty}\, (i \sqcup j)\, \Gamma\).
    \item Introduction: \(\langle u, v \rangle : \mathrm{Tm}\, \Gamma\, A \to \mathrm{Tm}\, \Gamma\, (B[\mathrm{id}, u]) \to \mathrm{Tm}\, \Gamma\, (\Sigma A B)\).
    \item Projections: \(\mathrm{fst} : \mathrm{Tm}\, \Gamma\, (\Sigma A B) \to \mathrm{Tm}\, \Gamma\, A\), \(\mathrm{snd} : \mathrm{Tm}\, \Gamma\, (\Sigma A B) \to \mathrm{Tm}\, \Gamma\, (B[\mathrm{id}, \mathrm{fst}\, t])\).
\end{itemize}

Equations include \(\mathrm{fst}\, \langle u, v \rangle = u\), \(\mathrm{snd}\, \langle u, v \rangle = v\).

% Subsubsection: Universes
\subsection{Universes}
A hierarchy of universes:
\begin{itemize}
    \item Formation: \(\mathrm{U} : (i : \mathbb{N}) \to \mathrm{Ty}\, (i+1)\, \Gamma\).
    \item Coding: \(c : \mathrm{Ty}\, i\, \Gamma \to \mathrm{Tm}\, \Gamma\, (\mathrm{U}\, i)\).
    \item Decoding: \(\_ : \mathrm{Tm}\, \Gamma\, (\mathrm{U}\, i) \to \mathrm{Ty}\, i\, \Gamma\).
\end{itemize}

Equations: \(\underline{c A} = A\), \(c \underline{a} = a\).

% Subsubsection: Booleans and Identity Types
\subsection{Booleans and Identity Types}
\begin{itemize}
    \item Booleans: \(\mathrm{Bool} : \mathrm{Ty}\, 0\, \Gamma\), with \(\mathrm{true}, \mathrm{false} : \mathrm{Tm}\, \Gamma\, \mathrm{Bool}\), and an eliminator \(\mathrm{if}\).
    \item Identity: \(\mathrm{Id} : (A : \mathrm{Ty}\, i\, \Gamma) \to \mathrm{Tm}\, \Gamma\, A \to \mathrm{Tm}\, \Gamma\, A \to \mathrm{Ty}\, i\, \Gamma\), with \(\mathrm{refl} : \mathrm{Tm}\, \Gamma\, (\mathrm{Id}\, A\, u\, u)\) and eliminator \(\mathrm{J}\).
\end{itemize}

% Section: Semantics via the Standard Model
\subsection{Semantics via the Standard Model}
The standard model interprets the CwF in a type theory like Agda, mapping contexts to types, types to type families, and substitutions to functions. For example:
\begin{itemize}
    \item \(\mathrm{Con}\, i = \mathrm{Set}\, i\).
    \item \(\mathrm{Ty}\, j\, \Gamma = \Gamma \to \mathrm{Set}\, j\).
    \item \(\mathrm{Sub}\, \Gamma\, \Delta = \Gamma \to \Delta\).
    \item \(\mathrm{Tm}\, \Gamma\, A = (y : \Gamma) \to A\, y\).
\end{itemize}

Type formers are interpreted directly, e.g., \(\Pi A B = \lambda \gamma . (x : A \gamma) \to B (\gamma, x)\). This model ensures that all equations hold definitionally, simplifying metatheoretic reasoning.

\subsection{Applications}
The CwF formulation enables concise proofs of metatheoretic properties like canonicity (every closed \(\mathrm{Bool}\) term is \(\mathrm{true}\) or \(\mathrm{false}\)) and parametricity (terms respect type abstractions). These proofs leverage the initiality of the syntax, allowing induction over the algebraic structure.

\subsection{Conclusion}
The Categories with Families framework provides a robust and elegant formalization of MLTT-75, capturing its syntax and semantics as an initial model. By structuring contexts, types, and terms categorically, CwFs facilitate rigorous metatheoretic analysis, making them invaluable for type theory research and implementation in proof assistants.

\begin{thebibliography}{9}
\subsubsection*{CwF Models}
\bibitem{Dybjer1995} P. Dybjer, ``Internal type theory,'' \emph{International Workshop on Types for Proofs and Programs}, pp. 120--134, Springer, 1995.
\bibitem{Kaposi2019} A. Kaposi, A. Kovács, N. Kraus, ``Shallow embedding of type theory is morally correct,'' \emph{Proceedings of the ACM on Programming Languages}, 3(POPL), 2, 2019.
\subsubsection*{Other Models}
\bibitem{awodey2019} Awodey, S., Frey, J., Speight, S., ``Categorical Structures for Type Theory in Univalent Foundations,'' arXiv:1907.07562, 2019.
\bibitem{hofmann1997} Hofmann, M., ``On the interpretation of type theory in locally cartesian closed categories,'' LFCS, 1997.
\bibitem{jacobs1993} Jacobs, B., ``Comprehension categories and the semantics of type dependency,'' TCS, 1993.
\bibitem{awodey} Awodey, S., ``Natural models of homotopy type theory,'' MSCS, 2018.
\end{thebibliography}

\end{document}
